<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Master Tracker | Cloud Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>

    <style>
        :root {
            --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --border: #334155; --accent: #818cf8;
            --status-upcoming: #a29bfe; --status-start: #00b894; --status-processing: #fdcb6e; 
            --status-done: #0984e3; --status-failure: #e17055; --danger: #ff7675;
        }
        [data-theme="light"] {
            --bg: #f0f2f5; --card: #ffffff; --text: #2d3436; --border: #dfe6e9; --accent: #6c63ff;
        }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; transition: 0.3s; }
        #loginScreen { position: fixed; inset: 0; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 10000; }
        .login-card { background: var(--card); padding: 40px; border-radius: 25px; text-align: center; border: 1px solid var(--border); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .google-btn { background: white; color: #444; padding: 12px 24px; border-radius: 8px; font-weight: bold; border: none; cursor: pointer; display: flex; align-items: center; gap: 10px; margin: 20px auto; }
        #mainApp { display: none; height: 100vh; }
        .sidebar { width: 350px; background: var(--card); border-right: 1px solid var(--border); padding: 20px; overflow-y: auto; display: flex; flex-direction: column; }
        .main-content { flex: 1; padding: 25px; overflow-y: auto; display: flex; flex-direction: column; align-items: center; }
        .form-card { background: var(--card); padding: 20px; border-radius: 20px; width: 100%; max-width: 1000px; display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-bottom: 25px; border: 1px solid var(--border); }
        input, select, button { padding: 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text); outline: none; }
        button { cursor: pointer; background: var(--accent); color: white; font-weight: bold; border: none; }
        .project-item { padding: 10px; background: var(--bg); border-radius: 8px; margin-bottom: 8px; cursor: pointer; border: 1px solid transparent; font-size: 14px; }
        .project-item.active { background: var(--accent); color: white; }
        table { width: 100%; border-collapse: collapse; background: var(--card); border-radius: 15px; overflow: hidden; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border); font-size: 13px; }
        .status-badge { padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; color: white; text-transform: uppercase; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: var(--border); width: 100%; max-width: 1000px; border-radius: 15px; overflow: hidden; }
        .cal-day { min-height: 80px; background: var(--card); padding: 5px; font-size: 12px; }
        .cal-entry { font-size: 9px; padding: 2px 4px; border-radius: 3px; color: white; margin-top: 2px; }
        .hidden { display: none; }
        #modalOverlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 9999; }
        .modal-content { background: var(--card); padding: 30px; border-radius: 20px; width: 400px; text-align: center; }
    </style>
</head>
<body data-theme="dark">

<div id="loginScreen">
    <div class="login-card">
        <h1 style="color:var(--accent)">Tracker Pro</h1>
        <p>Use your GitHub Live Link to Sign In</p>
        <button class="google-btn" onclick="googleLogin()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18">
            Login with Google
        </button>
    </div>
</div>

<div id="mainApp">
    <div class="sidebar">
        <div style="display:flex; align-items:center; gap:10px; margin-bottom:20px;">
            <img id="uPic" style="width:35px; border-radius:50%">
            <div id="uName" style="font-weight:bold; font-size:14px">User</div>
        </div>
        <button onclick="showCreateUI()" style="background:#6c5ce7; padding:12px; margin-bottom:20px;">ðŸš€ Create New Board</button>
        <h3>All Projects</h3>
        <div id="projectList"></div>
        <button onclick="logout()" style="background:none; color:var(--danger); border:1px solid var(--danger); margin-top:auto;">Logout</button>
    </div>

    <div class="main-content">
        <div style="width:100%; max-width:1000px; display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 id="projTitle" style="margin:0">Dashboard</h2>
            <div style="display:flex; gap:10px;">
                <button onclick="showShareUI()" style="background:#00b894">ðŸ”— Share</button>
                <button onclick="toggleView()" id="viewBtn" style="background:transparent; color:var(--accent); border:1px solid var(--accent);">Calendar View</button>
            </div>
        </div>

        <div class="form-card" id="inputForm">
            <input type="date" id="dateInput">
            <input type="text" id="nameInput" placeholder="Name">
            <input type="text" id="taskInput" placeholder="Task description">
            <input type="number" id="hourInput" placeholder="Hrs">
            <select id="statusInput">
                <option value="upcoming">Upcoming</option>
                <option value="start">Start</option>
                <option value="processing">Processing</option>
                <option value="done">Done</option>
                <option value="failure">Failure</option>
            </select>
            <button id="mainBtn" onclick="saveData()">Add Entry</button>
        </div>

        <div id="listView" style="width:100%; max-width:1000px;">
            <table>
                <thead><tr><th>Date</th><th>Name</th><th>Task</th><th>Hrs</th><th>Status</th><th>Action</th></tr></thead>
                <tbody id="tableRows"></tbody>
            </table>
        </div>
        <div id="calendarView" class="hidden" style="width:100%; max-width:1000px;">
            <div id="calendarGrid" class="calendar-grid"></div>
        </div>
    </div>
</div>

<div id="modalOverlay"><div class="modal-content" id="modalUI"></div></div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAniXAhKdfB9Qlhwq6bBfvnqv_rDcsV4ug",
        authDomain: "tracker-work-fa62f.firebaseapp.com",
        projectId: "tracker-work-fa62f",
        storageBucket: "tracker-work-fa62f.firebasestorage.app",
        messagingSenderId: "827983608665",
        appId: "1:827983608665:web:7c0bd84cce2961e0e5aa48",
        databaseURL: "https://tracker-work-fa62f-default-rtdb.firebaseio.com"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    const urlParams = new URLSearchParams(window.location.search);
    const activeProject = urlParams.get('project') || 'General';
    const activeRole = urlParams.get('role') || 'owner';

    function googleLogin() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).catch(e => alert("Please open the site via HTTPS (GitHub Link) to login. Error: " + e.message));
    }
    function logout() { auth.signOut().then(() => window.location.href = window.location.origin + window.location.pathname); }

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'flex';
            document.getElementById('uPic').src = user.photoURL;
            document.getElementById('uName').innerText = user.displayName;
            initApp();
        }
    });

    function initApp() {
        document.getElementById('projTitle').innerText = activeProject;
        if(activeRole === 'viewer') document.getElementById('inputForm').style.display = 'none';

        db.ref('projects').on('value', snap => {
            const list = document.getElementById('projectList'); list.innerHTML = '';
            Object.keys(snap.val() || {}).forEach(name => {
                const div = document.createElement('div');
                div.className = `project-item ${name === activeProject ? 'active' : ''}`;
                div.innerHTML = `ðŸ“ ${name}`;
                div.onclick = () => window.location.href = `?project=${name}&role=${activeRole}`;
                list.appendChild(div);
            });
        });

        db.ref('projects/' + activeProject).on('value', snap => {
            render(Object.keys(snap.val() || {}).map(k => ({...snap.val()[k], id: k})));
        });
    }

    function saveData() {
        const d = {
            date: document.getElementById('dateInput').value,
            name: document.getElementById('nameInput').value || auth.currentUser.displayName,
            task: document.getElementById('taskInput').value,
            hours: document.getElementById('hourInput').value,
            status: document.getElementById('statusInput').value,
            ts: Date.now()
        };
        if(!d.task) return alert("Task required");
        db.ref(`projects/${activeProject}`).push(d);
        document.getElementById('taskInput').value = '';
    }

    function render(data) {
        const tbody = document.getElementById('tableRows');
        tbody.innerHTML = data.sort((a,b)=>b.ts-a.ts).map(e => `
            <tr>
                <td>${e.date}</td>
                <td><span style="background:${getColor(e.name)}; padding:3px 8px; border-radius:5px; font-weight:bold; color:white;">${e.name}</span></td>
                <td>${e.task}</td><td>${e.hours}h</td>
                <td><span class="status-badge" style="background:var(--status-${e.status})">${e.status}</span></td>
                <td>${activeRole === 'owner' ? `<button onclick="del('${e.id}')" style="background:var(--danger)">Del</button>` : ''}</td>
            </tr>`).join('');
        renderCal(data);
    }

    function renderCal(data) {
        const grid = document.getElementById('calendarGrid'); grid.innerHTML = '';
        for(let i=1; i<=31; i++) {
            const d = document.createElement('div'); d.className = 'cal-day'; d.innerHTML = `<b>${i}</b>`;
            const dateStr = `2026-02-${String(i).padStart(2,'0')}`;
            data.filter(e => e.date === dateStr).forEach(e => {
                const en = document.createElement('div'); en.className = 'cal-entry'; en.style.background = getColor(e.name);
                en.innerHTML = e.name; d.appendChild(en);
            });
            grid.appendChild(d);
        }
    }

    function showCreateUI() {
        document.getElementById('modalOverlay').style.display = 'flex';
        document.getElementById('modalUI').innerHTML = `<h3>New Board</h3><input id="nbn" placeholder="Name" style="width:80%; margin:15px;"><br><button onclick="cb()">Create</button>`;
    }
    function cb() {
        const n = document.getElementById('nbn').value.trim();
        if(n) { db.ref(`projects/${n}/init`).set(Date.now()); window.location.href = `?project=${n}&role=owner`; }
    }
    function showShareUI() {
        const b = window.location.origin + window.location.pathname;
        document.getElementById('modalOverlay').style.display = 'flex';
        document.getElementById('modalUI').innerHTML = `<h3>Links</h3><p>Editor:</p><div style="font-size:10px; background:#000; padding:10px;">${b}?project=${activeProject}&role=editor</div><button onclick="closeM()" style="margin-top:10px;">Close</button>`;
    }

    function del(id) { if(confirm("Delete?")) db.ref(`projects/${activeProject}/${id}`).remove(); }
    function closeM() { document.getElementById('modalOverlay').style.display = 'none'; }
    function getColor(n) { let h=0; for(let i=0; i<n.length; i++) h=n.charCodeAt(i)+((h<<5)-h); return `hsl(${Math.abs(h)%360},60%,45%)`; }
    function toggleView() { document.getElementById('listView').classList.toggle('hidden'); document.getElementById('calendarView').classList.toggle('hidden'); }
    function toggleTheme() { document.body.setAttribute('data-theme', document.body.getAttribute('data-theme')==='dark'?'light':'dark'); }
    document.getElementById('dateInput').valueAsDate = new Date();
</script>
</body>
</html>